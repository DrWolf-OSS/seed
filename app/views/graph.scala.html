@(landslip: Landslip, sensorForm: Form[Sensor])
@import helper._

@main("Franes", landslip.name, landslip.description) {

<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
<script src="@routes.Assets.at("javascripts/TrackballControls.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/Detector.js")" type="text/javascript"></script>
<div class="span10 offset1">
  <div id="container"></div>
  <div id="info">
    <a href="http://threejs.org" target="_blank">three.js</a> - trackball controls example</br>
    MOVE mouse &amp; press LEFT/A: rotate, MIDDLE/S: zoom, RIGHT/D: pan
  </div>


  <script>

    var positions = new Array();
    var i = 0;
    @for(sensor<- landslip.sensors){
      @for(position<- sensor.positions){
        @if(position.t==1){
          positions[i] = new Array(4);
          positions[i][0] = @position.x;
          positions[i][1] = @position.y;
          positions[i][2] = @position.z;
        }
      }
      i++;
    }
    if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

    var container;

    var camera, controls, scene, renderer;

    var cross;

    // an array to store our particles in
    particles = [];


    init();
    animate();

    function init() {

      camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 1000 );
      camera.position.z = 500;

      controls = new THREE.TrackballControls( camera );

      controls.rotateSpeed = 1.0;
      controls.zoomSpeed = 1.2;
      controls.panSpeed = 0.8;

      controls.noZoom = false;
      controls.noPan = false;

      controls.staticMoving = true;
      controls.dynamicDampingFactor = 0.3;

      controls.keys = [ 65, 83, 68 ];

      controls.addEventListener( 'change', render );

      // world

      scene = new THREE.Scene();
      scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );

      var geometry = new THREE.CylinderGeometry( 0, 10, 30, 4, 1 );
      var material =  new THREE.MeshLambertMaterial( { color:0xffffff, shading: THREE.FlatShading } );


      var mesh = new THREE.Mesh( geometry, material );
      mesh.position.x = ( Math.random() - 0.5 ) * 1000;
      mesh.position.y = ( Math.random() - 0.5 ) * 1000;
      mesh.position.z = ( Math.random() - 0.5 ) * 1000;
      mesh.updateMatrix();
      mesh.matrixAutoUpdate = false;
      scene.add( mesh );
      for(i in positions){
        object = new THREE.Mesh( new THREE.TetrahedronGeometry( 75, 0 ), material );
        object.position.set( 200, 0, 200 );


        object.position.x = positions[i][0];
        object.position.y = positions[i][1];
        object.position.z = positions[i][2];


        // add it to the scene
        scene.add( object );

        particles.push(object);
      }
      // renderer
      renderer = new THREE.WebGLRenderer( { antialias: false } );
      renderer.setClearColor( scene.fog.color, 1 );
      renderer.setSize( window.innerWidth, window.innerHeight );

      container = document.getElementById( 'container' );
      container.appendChild( renderer.domElement );


    }

    function makeParticles(positions){

      for(i in positions){
        var material = new THREE.MeshBasicMaterial( { color: Math.random() * 0x808008 + 0x808080 } );
        object = new THREE.Mesh( new THREE.TetrahedronGeometry( 75, 0 ), material );

        object.position.x = positions[i][0];
        object.position.y = positions[i][1];
        object.position.z = positions[i][2];


        // add it to the scene
        scene.add( object );

        // and to the array of particles.
        //particles.push(object);
      }
    };
    function animate() {
      requestAnimationFrame( animate );
      controls.update();

    }

    function render() {

      renderer.render( scene, camera );


    }

  </script>

  }
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->


